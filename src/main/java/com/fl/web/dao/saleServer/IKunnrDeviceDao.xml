<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.fl.web.dao.saleServer.IKunnrDeviceDao">

    <resultMap type="TKunnrDevice" id="kdMap">
        <result property="id" column="id"/>
        <result property="kunnr" column="kunnr"/>
        <result property="kunnrName" column="kunnr_name"/>
        <result property="address" column="address"/>
        <result property="contactInfo" column="contact_info"/>
        <result property="contactTel" column="contact_tel"/>
        <result property="deviceSN" column="device_sn"/>
        <result property="deviceName" column="device_name"/>
        <result property="deviceNorms" column="device_norms"/>
        <result property="productionDate" column="production_date"/>
        <result property="installDate" column="install_date"/>
        <result property="installAddr" column="install_addr"/>
        <result property="installType" column="install_type"/>
        <result property="validityDate" column="validity_date"/>
        <result property="note" column="note"/>
        <result property="flag" column="flag"/>
        <result property="status" column="status"/>
        <result property="createBy" column="create_by"/>
        <result property="createDate" column="create_date"/>
        <result property="updateBy" column="update_by"/>
        <result property="updateDate" column="update_date"/>
    </resultMap>

    <select id="queryKunnrDeviceList" resultMap="kdMap" parameterType="KunnrDevice">
        SELECT
        kd.id,
        kd.kunnr,
        k.kunnr_name,
        k.address,
        k.contact_info,
        k.contact_tel,
        kd.device_sn,
        d.device_name,
        d.device_norms,
        kd.production_date,
        kd.install_date,
        kd.install_addr,
        kd.install_type,
        kd.validity_date,
        kd.note,
        kd.flag,
        kd.create_by,
        kd.create_date,
        kd.update_by,
        kd.update_date
        FROM
        kunnr_device kd
        LEFT JOIN kunnr_info k ON kd.kunnr = k.kunnr
        LEFT JOIN device_info d ON kd.device_sn = d.device_sn
        WHERE
        kd.status != '003'
        <if test="kunnr != null">
            and kd.kunnr like #{kunnr}
        </if>
        <if test="kunnrName != null">
            and k.kunnr_name like #{kunnrName}
        </if>
        <if test="deviceSN != null">
            and kd.device_sn like #{deviceSN}
        </if>
        <if test="deviceName != null">
            and d.device_name like #{deviceName}
        </if>
        <if test="deviceNorms != null">
            and d.device_norms like #{deviceNorms}
        </if>
        <if test="installType != null and installType!='' ">
            and kd.install_type = #{installType}
        </if>
        order by kd.kunnr
    </select>


    <select id="checkDataExist" resultType="TKunnrDevice">
        SELECT
        kd.id,
        kd.kunnr,
        kd.device_sn deviceSN,
        kd.production_date productionDate,
        kd.install_date installDate,
        kd.install_addr installAddr,
        kd.install_type installType,
        kd.validity_date validityDate,
        kd.note,
        kd.create_by,
        kd.create_date,
        kd.update_by,
        kd.update_date
        FROM
        kunnr_device kd
        WHERE
        kd.status != '003' and kd.kunnr=#{kunnr} and kd.device_sn=#{deviceSN}
    </select>


    <insert id="saveKunnrDevice" parameterType="TKunnrDevice">
        insert into kunnr_device (id,kunnr,device_sn,production_date,
            install_date,install_addr,install_type,validity_date,note,flag,create_by,create_date,status)
        values (#{id}, #{kunnr},#{deviceSN},#{productionDate},
            #{installDate},#{installAddr},#{installType},#{validityDate},#{note},#{flag},#{createBy},#{createDate},#{status})
    </insert>

    <update id="deleteKunnrDevice" parameterType="java.util.Map">
        update kunnr_device set status=#{status}, update_by = #{updateBy},update_date = #{updateDate}
        where id=#{id}
    </update>


    <update id="updateKunnrDeviceFlag" parameterType="java.util.Map">
        update kunnr_device set flag=#{flag},status=#{status}, update_by = #{updateBy},update_date = #{updateDate}
        where id=#{id}
    </update>
</mapper>